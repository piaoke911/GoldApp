name: Global-Quant-Master-Final-Build
on: [push, workflow_dispatch]

jobs:
  build:
    # å¼ºåˆ¶ä½¿ç”¨ 22.04ï¼Œè¿™æ˜¯ç›®å‰æœ€ç¨³çš„å®‰å“ç¼–è¯‘ç¯å¢ƒ
    runs-on: ubuntu-22.04
    
    steps:
      - name: ğŸš€ 1. æºç åŒæ­¥
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ 2. æ·±åº¦æ¸…ç†ä¸åœ°åŸºæ­å»º
        run: |
          sudo apt update
          sudo apt install -y \
            python3-pip python3-setuptools git zip unzip \
            openjdk-17-jdk autoconf libtool pkg-config zlib1g-dev \
            libncurses5-dev libncursesw5-dev libtinfo5 cmake libltdl-dev \
            libffi-dev libssl-dev

      - name: ğŸ› ï¸ 3. æ ¸å¿ƒå·¥å…·é“¾æ³¨å…¥
        run: |
          pip3 install --upgrade pip
          # é”æ­» Cython ç‰ˆæœ¬ï¼Œè¿™æ˜¯ Kivy ç¼–è¯‘æˆåŠŸçš„å…³é”®
          pip3 install --user --upgrade buildozer Cython==0.29.36 virtualenv
          # ç¡®ä¿ç³»ç»Ÿèƒ½æ‰¾åˆ° buildozer
          echo "/home/runner/.local/bin" >> $GITHUB_PATH

      - name: ğŸ§  4. å¼€å¯å…¨è‡ªåŠ¨åŒ–ç¼–è¯‘
        run: |
          # è‡ªåŠ¨æ¥å—æ‰€æœ‰å®‰å“åè®®ï¼Œé˜²æ­¢åå°æ­»ç­‰
          yes | buildozer android debug
        env:
          APP_ANDROID_ACCEPT_SDK_LICENSE: "1"
          BUILDOZER_USE_SUDO: "0"

      - name: ğŸ“¦ 5. æœ€ç»ˆ APK æˆæœæå–
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: Gold-Quant-Alpha-App
          path: |
            bin/*.apk
            .buildozer/android/platform/build-arm64-v8a/dists/goldquant/*.log
