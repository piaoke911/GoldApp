name: Gold-Quant-Legacy-Build
on: [push]

jobs:
  build:
    # æ ¸å¿ƒä¿®æ”¹ï¼šå¼ºåˆ¶ä½¿ç”¨ 22.04 è€ç‰ˆæœ¬ï¼Œç»•è¿‡æ‰€æœ‰ PIP æƒé™é”
    runs-on: ubuntu-22.04
    
    steps:
      - name: ğŸš€ 1. æºç åŒæ­¥
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ 2. ç¯å¢ƒæ¸…ç†ä¸æ„å»º (è€å…µæ¨¡å¼)
        run: |
          # é‡Šæ”¾ç£ç›˜ç©ºé—´
          sudo rm -rf /usr/share/dotnet
          sudo rm -rf /opt/ghc
          
          # å®‰è£…åŸºç¡€ä¾èµ–
          sudo apt update
          sudo apt install -y \
            python3-pip \
            python3-setuptools \
            git \
            zip \
            unzip \
            openjdk-17-jdk \
            autoconf \
            libtool \
            libffi-dev \
            libssl-dev \
            virtualenv

      - name: ğŸ› ï¸ 3. å®‰è£… Buildozer (æ— è§†è­¦å‘Šç‰ˆ)
        run: |
          pip3 install --upgrade pip
          # è¿™é‡ŒæŒ‡å®š Cython æ—§ç‰ˆæœ¬ï¼Œé˜²æ­¢æ–°ç‰ˆæœ¬ä¸å…¼å®¹
          pip3 install --user --upgrade buildozer Cython==0.29.36

      - name: ğŸ§  4. å¯åŠ¨é»„é‡‘ç¼–è¯‘
        run: |
          # æ³¨å…¥ç¯å¢ƒå˜é‡
          export PATH=$PATH:~/.local/bin
          
          # å¼ºåˆ¶åŒæ„åè®®å¹¶å¼€å§‹ç¼–è¯‘
          yes | buildozer android debug
        env:
          APP_ANDROID_ACCEPT_SDK_LICENSE: "1"
          BUILDOZER_USE_SUDO: "0"

      - name: ğŸ“¦ 5. æˆæœæå–
        if: always() # æ— è®ºæˆåŠŸå¤±è´¥éƒ½å°è¯•æå–æ—¥å¿—
        uses: actions/upload-artifact@v4
        with:
          name: GoldApp-Result
          path: |
            bin/*.apk
            .buildozer/android/platform/build-arm64-v8a/dists/goldquant/*.log
